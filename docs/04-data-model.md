# Data Model

## SQLite Schema

```sql
-- Company profiles created by Agent 1
CREATE TABLE companies (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    industry TEXT NOT NULL,
    tone_of_voice TEXT,
    target_audience TEXT,
    campaign_goals TEXT,
    competitors TEXT,           -- JSON array
    content_history TEXT,       -- JSON array
    visual_style TEXT,
    voice_alignment_threshold REAL DEFAULT 0.7,
    voice_profile_id TEXT,        -- Internal profile derived from Modulate STT output
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Polymarket signals surfaced by Agent 2
CREATE TABLE trend_signals (
    id TEXT PRIMARY KEY,
    polymarket_market_id TEXT,
    title TEXT NOT NULL,
    category TEXT,              -- politics, crypto, macro, tech, etc.
    probability REAL,
    probability_momentum REAL,  -- rate of change
    volume REAL,
    volume_velocity REAL,       -- rate of volume change
    relevance_scores TEXT,      -- JSON: {company_id: score}
    surfaced_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP
);

-- Campaign concepts generated by Agent 3
CREATE TABLE campaigns (
    id TEXT PRIMARY KEY,
    company_id TEXT REFERENCES companies(id),
    trend_signal_id TEXT REFERENCES trend_signals(id),
    headline TEXT NOT NULL,
    body_copy TEXT NOT NULL,
    visual_direction TEXT,
    visual_asset_url TEXT,      -- Flora AI generated asset
    confidence_score REAL,
    channel_recommendation TEXT,
    channel_reasoning TEXT,
    voice_alignment_score REAL,  -- In-app voice-match score using Modulate STT-derived profile
    voice_alignment_passed BOOLEAN DEFAULT TRUE,
    status TEXT DEFAULT 'draft', -- draft, approved, posted, completed
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Performance data for Loop 1
CREATE TABLE campaign_metrics (
    id TEXT PRIMARY KEY,
    campaign_id TEXT REFERENCES campaigns(id),
    channel TEXT,
    impressions INTEGER DEFAULT 0,
    clicks INTEGER DEFAULT 0,
    engagement_rate REAL DEFAULT 0.0,
    sentiment_score REAL,       -- -1.0 to 1.0
    measured_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Agent prompt weights updated by Loop 1 (per company)
CREATE TABLE prompt_weights (
    id TEXT PRIMARY KEY,
    company_id TEXT REFERENCES companies(id),
    agent_name TEXT NOT NULL,
    weight_key TEXT NOT NULL,    -- e.g., "tone_aggressive", "hook_question"
    weight_value REAL DEFAULT 1.0,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(company_id, agent_name, weight_key)
);

-- Shared patterns for Loop 2 (cross-company)
CREATE TABLE shared_patterns (
    id TEXT PRIMARY KEY,
    pattern_type TEXT,          -- style, timing, channel, signal
    description TEXT,
    conditions TEXT,            -- JSON: when this pattern applies
    effect TEXT,                -- JSON: what the pattern predicts
    confidence REAL,
    sample_size INTEGER,
    discovered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Signal calibration for Loop 3
CREATE TABLE signal_calibration (
    id TEXT PRIMARY KEY,
    signal_category TEXT,
    probability_threshold REAL,
    volume_velocity_threshold REAL,
    predicted_engagement REAL,
    actual_engagement REAL,
    accuracy_score REAL,
    company_type TEXT,          -- which company types this applies to
    calibrated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Braintrust trace references
CREATE TABLE agent_traces (
    id TEXT PRIMARY KEY,
    agent_name TEXT NOT NULL,
    braintrust_trace_id TEXT,
    company_id TEXT REFERENCES companies(id),
    input_summary TEXT,
    output_summary TEXT,
    quality_score REAL,         -- Braintrust evaluation score
    tokens_used INTEGER,
    latency_ms INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Entity Relationship Summary

```
companies ──< campaigns ──< campaign_metrics
    │              │
    │              └── trend_signals
    │
    ├──< prompt_weights
    └──< agent_traces

shared_patterns (cross-company, no FK)
signal_calibration (cross-company, no FK)
```

## Key Design Decisions

- **TEXT primary keys**: UUIDs generated at application level for portability
- **JSON columns**: `competitors`, `content_history`, `relevance_scores`, `conditions`, `effect` — SQLite handles JSON natively via `json_extract()`
- **WAL mode**: Enabled for concurrent reads during dashboard queries
- **No ORM**: Raw SQL via `aiosqlite` for maximum control in a hackathon

---

**Prev**: [Sponsor Integrations](./03-sponsor-integrations.md) | **Next**: [API Design](./05-api-design.md) | [Full Index](../ARCHITECTURE.md)
