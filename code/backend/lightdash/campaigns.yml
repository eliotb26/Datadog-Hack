# Lightdash metric definitions — campaigns explore
#
# This file defines the metrics Lightdash exposes for the campaigns table.
# Upload / sync to your Lightdash project after running dbt (or the SQLite adapter).
#
# Dashboard panel: Campaign Performance  →  feeds Loop 1 (prompt weight updates)

version: 2

models:
  - name: campaigns
    label: "Campaigns"
    description: "Marketing campaigns generated by Agent 3 and routed by Agent 4."

    columns:
      - name: id
        label: "Campaign ID"
        description: "Unique identifier for the campaign."

      - name: company_id
        label: "Company ID"
        description: "Foreign key to the companies table."
        meta:
          dimension:
            type: string

      - name: trend_signal_id
        label: "Trend Signal ID"
        description: "The Polymarket signal that inspired this campaign."

      - name: headline
        label: "Headline"
        description: "Campaign headline text."

      - name: channel_recommendation
        label: "Channel"
        description: "Recommended distribution channel (twitter, linkedin, email, etc.)."
        meta:
          dimension:
            type: string

      - name: confidence_score
        label: "Confidence Score"
        description: "Agent 3 confidence in this campaign concept (0–1)."
        meta:
          dimension:
            type: number
          metrics:
            avg_confidence_score:
              type: average
              label: "Avg Confidence Score"
              description: "Average confidence across campaigns in the selected period."
              round: 3

      - name: safety_score
        label: "Safety Score"
        description: "Modulate ToxMod safety score (higher = safer)."
        meta:
          metrics:
            avg_safety_score:
              type: average
              label: "Avg Safety Score"
              round: 3

      - name: safety_passed
        label: "Safety Passed"
        description: "Whether the campaign passed content safety screening."
        meta:
          dimension:
            type: boolean
          metrics:
            count:
              type: count
              label: "Total Campaigns"
            blocked_count:
              type: count
              label: "Blocked Campaigns"
              filters:
                - field: safety_passed
                  operator: "equals"
                  value: false
            passed_count:
              type: count
              label: "Passed Safety Check"
              filters:
                - field: safety_passed
                  operator: "equals"
                  value: true

      - name: status
        label: "Status"
        description: "Campaign status: draft | approved | posted | archived."
        meta:
          dimension:
            type: string

      - name: created_at
        label: "Created At"
        description: "Timestamp when the campaign was generated."
        meta:
          dimension:
            type: timestamp
            time_intervals: ["DAY", "WEEK", "MONTH"]

  - name: campaign_metrics
    label: "Campaign Metrics"
    description: "Post-publication performance metrics for each campaign."

    columns:
      - name: campaign_id
        label: "Campaign ID"
        description: "Foreign key to campaigns."

      - name: channel
        label: "Channel"
        description: "Distribution channel where the campaign was published."
        meta:
          dimension:
            type: string

      - name: impressions
        label: "Impressions"
        description: "Number of times the campaign was shown."
        meta:
          metrics:
            avg_impressions:
              type: average
              label: "Avg Impressions"
              round: 0
            total_impressions:
              type: sum
              label: "Total Impressions"

      - name: clicks
        label: "Clicks"
        description: "Number of clicks on the campaign."
        meta:
          metrics:
            avg_clicks:
              type: average
              label: "Avg Clicks"
              round: 0
            total_clicks:
              type: sum
              label: "Total Clicks"

      - name: engagement_rate
        label: "Engagement Rate"
        description: "Clicks / Impressions ratio."
        meta:
          metrics:
            avg_engagement_rate:
              type: average
              label: "Avg Engagement Rate"
              round: 4
              format: percent
            max_engagement_rate:
              type: max
              label: "Peak Engagement Rate"
              round: 4

      - name: sentiment_score
        label: "Sentiment Score"
        description: "Audience sentiment score from analytics (-1 negative → +1 positive)."
        meta:
          metrics:
            avg_sentiment_score:
              type: average
              label: "Avg Sentiment"
              round: 3

      - name: measured_at
        label: "Measured At"
        description: "When these metrics were recorded."
        meta:
          dimension:
            type: timestamp
            time_intervals: ["DAY", "WEEK", "MONTH"]
